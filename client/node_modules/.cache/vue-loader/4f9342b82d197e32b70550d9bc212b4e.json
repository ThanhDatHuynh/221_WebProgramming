{"remainingRequest":"/home/dathuynh/Workspace/221_Web_Programming/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/dathuynh/Workspace/221_Web_Programming/client/src/pages/EditDishPage.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/dathuynh/Workspace/221_Web_Programming/client/src/pages/EditDishPage.vue","mtime":1654787623627},{"path":"/home/dathuynh/Workspace/221_Web_Programming/client/node_modules/babel-loader/lib/index.js","mtime":1654787234061},{"path":"/home/dathuynh/Workspace/221_Web_Programming/client/node_modules/cache-loader/dist/cjs.js","mtime":1654787234194},{"path":"/home/dathuynh/Workspace/221_Web_Programming/client/node_modules/vue-loader/lib/index.js","mtime":1654787310467}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBGb3JtIGZyb20gIi4uL2NvbXBvbmVudHMvRm9ybS52dWUiOwppbXBvcnQgKiBhcyB5dXAgZnJvbSAieXVwIjsKaW1wb3J0ICQgZnJvbSAianF1ZXJ5IjsKaW1wb3J0IE1vZGFsQ29uZmlybSBmcm9tICIuLi9jb21wb25lbnRzL01vZGFsQ29uZmlybS52dWUiOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJFZGl0RGlzaFBhZ2UiLAogIGNvbXBvbmVudHM6IHsgRm9ybSwgTW9kYWxDb25maXJtIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGlzRm9ybVN1Ym1pdGVkOiBmYWxzZSwKICAgICAgY3VycmVudERpc2hJZDogbnVsbCwKICAgICAgaXNDcmVhdGVEaXNoTW9kYWxPcGVuOiBmYWxzZSwKICAgICAgaXNFZGl0RGlzaE1vZGFsT3BlbjogZmFsc2UsCiAgICAgIGZvcm1EYXRhOiB7CiAgICAgICAgLy8gVnVlIE9iamVjdCBEYXRhIHdpbGwgYmUgY29udmVydCBpbnRvIE9ic2VydmVyCiAgICAgICAgZGlzaElkOiAiVGhpcyBmaWVsZCBpcyBvbWl0dGVkIHdoZW4gY3JlYXRpbmcgbmV3IGRpc2giLAogICAgICAgIGltYWdlVXJsOiAiIiwKICAgICAgICBkaXNoVGl0bGU6ICIiLAogICAgICAgIGRpc2hEZXNjcmlwdGlvbjogIiIsCiAgICAgIH0sCiAgICAgIGVycm9yTWVzc2FnZXM6IHsKICAgICAgICBkaXNoSWQ6ICIiLAogICAgICAgIGltYWdlVXJsOiAiIiwKICAgICAgICBkaXNoVGl0bGU6ICIiLAogICAgICAgIGRpc2hEZXNjcmlwdGlvbjogIiIsCiAgICAgIH0sCgogICAgICAvLyBBZGQgZmllbGQgd2l0aCBuYW1lIGluIGVycm9yTWVzc2FnZXMgZm9yIG90aGVycycgdmFsaWRhdGlvbgogICAgICBzY2hlbWE6IHl1cC5vYmplY3QoKS5zaGFwZSh7fSksCiAgICB9OwogIH0sCiAgYmVmb3JlTW91bnQoKSB7CiAgICB0aGlzLmN1cnJlbnREaXNoSWQgPSB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQ7CiAgICBpZiAodGhpcy5jdXJyZW50RGlzaElkKSB7CiAgICAgIHRoaXMuR2V0RGlzaERhdGEoKTsKICAgIH0KICB9LAoKICBtZXRob2RzOiB7CiAgICB0b2dnbGVNb2RhbE9wZW4odHlwZSkgewogICAgICBpZiAodHlwZSA9PT0gImNyZWF0ZURpc2giKSB7CiAgICAgICAgdGhpcy5pc0NyZWF0ZURpc2hNb2RhbE9wZW4gPSAhdGhpcy5pc0NyZWF0ZURpc2hNb2RhbE9wZW47CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gImVkaXREaXNoIikgewogICAgICAgIHRoaXMuaXNFZGl0RGlzaE1vZGFsT3BlbiA9ICF0aGlzLmlzRWRpdERpc2hNb2RhbE9wZW47CiAgICAgIH0KICAgIH0sCgogICAgR2V0RGlzaERhdGEoKSB7CiAgICAgIHZhciBzZXR0aW5ncyA9IHsKICAgICAgICB1cmw6IGAke3Byb2Nlc3MuZW52LlZVRV9BUFBfQVBJX1VSTH0vZGlzaC97JHt0aGlzLmN1cnJlbnREaXNoSWR9fWAsCiAgICAgICAgbWV0aG9kOiAiR0VUIiwKICAgICAgICB0aW1lb3V0OiAwLAogICAgICAgIGRhdGE6IHt9LAogICAgICAgIGhlYWRlcnM6IHt9LAogICAgICB9OwoKICAgICAgJC5hamF4KHNldHRpbmdzKS50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIHJlc3BvbnNlID0gSlNPTi5wYXJzZShyZXNwb25zZSk7CiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICBjb25zdCBkaXNoID0gcmVzcG9uc2UucmVzcG9uc2U7CiAgICAgICAgICB0aGlzLmZvcm1EYXRhLmRpc2hJZCA9IHRoaXMuY3VycmVudERpc2hJZDsKICAgICAgICAgIHRoaXMuZm9ybURhdGEuaW1hZ2VVcmwgPSBkaXNoLmltYWdlOwogICAgICAgICAgdGhpcy5mb3JtRGF0YS5kaXNoVGl0bGUgPSBkaXNoLm5hbWU7CiAgICAgICAgICB0aGlzLmZvcm1EYXRhLmRpc2hEZXNjcmlwdGlvbiA9IGRpc2guZGVzY3JpcHRpb247CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFsZXJ0KCJDYW5ub3QgZ2V0IGRpc2ggdG8gZWRpdCIpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIGFzeW5jIGhhbmRsZUlucHV0VmFsaWRhdGlvbih7IG5hbWUsIHZhbHVlIH0pIHsKICAgICAgbGV0IHZhbGlkYXRpb25SZXN1bHQgPSBhd2FpdCB0aGlzLnNjaGVtYQogICAgICAgIC52YWxpZGF0ZSh7IFtuYW1lXTogdmFsdWUgfSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICByZXR1cm4gZXJyb3I7CiAgICAgICAgfSk7CiAgICAgIGlmICh2YWxpZGF0aW9uUmVzdWx0LmVycm9ycykgewogICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlc1tuYW1lXSA9IHZhbGlkYXRpb25SZXN1bHQuZXJyb3JzWzBdOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlc1tuYW1lXSA9ICIiOwogICAgICB9CiAgICB9LAoKICAgIGhhbmRsZUZvcm1DaGFuZ2UobmV3RGF0YSkgewogICAgICB0aGlzLmZvcm1EYXRhW25ld0RhdGEubmFtZV0gPSBuZXdEYXRhLnZhbHVlOwogICAgICB0aGlzLmhhbmRsZUlucHV0VmFsaWRhdGlvbihuZXdEYXRhKTsKICAgIH0sCgogICAgaGFuZGxlU3VibWl0KCkgewogICAgICB2YXIgX190aGlzID0gdGhpczsKICAgICAgY29uc3QgZm9ybURhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuZm9ybURhdGEpKTsKCiAgICAgIGNvbnN0IFVzZXJUb2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJVc2VyVG9rZW4iKTsKICAgICAgaWYgKFVzZXJUb2tlbiA9PT0gIiIpIHsKICAgICAgICBhbGVydCgiUGxlYXNlIGxvZ2luIGFkbWluIGFjY291bnQgYmVmb3JlIHRvIGVkaXQgb3IgY3JlYXRlIGRpc2giKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuaXNGb3JtU3VibWl0ZWQgPSB0cnVlOwogICAgICBpZiAodGhpcy4kcm91dGUubmFtZSA9PT0gImFkbWluQ3JlYXRlRGlzaCIpIHsKICAgICAgICAvKioKICAgICAgICAgKiBIYW5kbGUgRWRpdCBQcm9maWxlCiAgICAgICAgICovCiAgICAgICAgdGhpcy50b2dnbGVNb2RhbE9wZW4oImNyZWF0ZURpc2giKTsKICAgICAgICBsZXQgc2V0dGluZ3MgPSB7CiAgICAgICAgICB1cmw6IGAke3Byb2Nlc3MuZW52LlZVRV9BUFBfQVBJX1VSTH0vYWRtaW4vY3JlYXRlX2Rpc2hgLAogICAgICAgICAgbWV0aG9kOiAicG9zdCIsCiAgICAgICAgICB0aW1lb3V0OiAwLAogICAgICAgICAgZGF0YTogewogICAgICAgICAgICBpbWFnZTogZm9ybURhdGEuaW1hZ2VVcmwsCiAgICAgICAgICAgIG5hbWU6IGZvcm1EYXRhLmRpc2hUaXRsZSwKICAgICAgICAgICAgZGVzY3JpcHRpb246IGZvcm1EYXRhLmRpc2hEZXNjcmlwdGlvbiwKICAgICAgICAgIH0sCiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICJCZWFyLVRva2VuIjogVXNlclRva2VuLAogICAgICAgICAgfSwKICAgICAgICB9OwogICAgICAgICQuYWpheChzZXR0aW5ncykuZG9uZShmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgcmVzcG9uc2UgPSBKU09OLnBhcnNlKHJlc3BvbnNlKTsKICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB7CiAgICAgICAgICAgIF9fdGhpcy4kcmVmcy5ub3RlVGl0bGUuaW5uZXJIVE1MID0gIllvdXIgRGlzaCBIYXZlIEJlZW4gQ3JlYXRlZCI7CiAgICAgICAgICAgIF9fdGhpcy4kcm91dGVyLnJlcGxhY2UoeyBuYW1lOiAiYWRtaW5NZW51IiB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9fdGhpcy4kcmVmcy5ub3RlVGl0bGUuaW5uZXJIVE1MID0gcmVzcG9uc2UubWVzc2FnZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0aGlzLiRyb3V0ZS5uYW1lID09PSAiYWRtaW5FZGl0RGlzaCIpIHsKICAgICAgICAvKioKICAgICAgICAgKiBIYW5kbGUgRWRpdCBQYXNzd29yZAogICAgICAgICAqLwogICAgICAgIHRoaXMudG9nZ2xlTW9kYWxPcGVuKCJlZGl0RGlzaCIpOwogICAgICAgIGxldCBzZXR0aW5ncyA9IHsKICAgICAgICAgIHVybDogYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9BUElfVVJMfS9hZG1pbi91cGRhdGVfZGlzaC97JHt0aGlzLmN1cnJlbnREaXNoSWR9fWAsCiAgICAgICAgICBtZXRob2Q6ICJwb3N0IiwKICAgICAgICAgIHRpbWVvdXQ6IDAsCiAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgIGltYWdlOiBmb3JtRGF0YS5pbWFnZVVybCwKICAgICAgICAgICAgbmFtZTogZm9ybURhdGEuZGlzaFRpdGxlLAogICAgICAgICAgICBkZXNjcmlwdGlvbjogZm9ybURhdGEuZGlzaERlc2NyaXB0aW9uLAogICAgICAgICAgfSwKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgIkJlYXItVG9rZW4iOiBVc2VyVG9rZW4sCiAgICAgICAgICB9LAogICAgICAgIH07CiAgICAgICAgJC5hamF4KHNldHRpbmdzKS5kb25lKGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICByZXNwb25zZSA9IEpTT04ucGFyc2UocmVzcG9uc2UpOwogICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSAyMDApIHsKICAgICAgICAgICAgX190aGlzLiRyZWZzLm5vdGVUaXRsZS5pbm5lckhUTUwgPSAiWW91ciBEaXNoIEhhdmUgQmVlbiBFZGl0ZWQiOwogICAgICAgICAgICBfX3RoaXMuJHJvdXRlci5yZXBsYWNlKHsgbmFtZTogImFkbWluTWVudSIgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfX3RoaXMuJHJlZnMubm90ZVRpdGxlLmlubmVySFRNTCA9IHJlc3BvbnNlLm1lc3NhZ2U7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgfSwKfTsK"},{"version":3,"sources":["EditDishPage.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuCA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EditDishPage.vue","sourceRoot":"src/pages","sourcesContent":["<template>\n  <div class=\"edit-dish-wrapper\">\n    <ModalConfirm\n      @toggleModalEvent=\"toggleModalOpen('createDish')\"\n      :isOpen=\"this.isCreateDishModalOpen\"\n      :title=\"'Create Dish Confirm'\"\n      :content=\"'You are about to create new dish'\"\n      @callbackEvent=\"handleSubmit\"\n    />\n    <ModalConfirm\n      @toggleModalEvent=\"toggleModalOpen('editDish')\"\n      :isOpen=\"this.isEditDishModalOpen\"\n      :title=\"'Edit Dish Confirm'\"\n      :content=\"'You are about to edit your dish'\"\n      @callbackEvent=\"handleSubmit\"\n    />\n    <div class=\"reservation-title\">\n      <p>Create/Edit Dish</p>\n    </div>\n    <div class=\"form-wrapper\">\n      <Form\n        :type=\"'EditDish'\"\n        :data=\"formData\"\n        :errorMessages=\"errorMessages\"\n        @onFormChange=\"handleFormChange\"\n        @onSubmit=\"\n          $route.name === 'adminCreateDish'\n            ? toggleModalOpen('createDish')\n            : toggleModalOpen('editDish')\n        \"\n      />\n      <div v-show=\"isFormSubmited\" class=\"reservation-note\" ref=\"note\">\n        <div ref=\"noteTitle\" class=\"note-title\"></div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Form from \"../components/Form.vue\";\nimport * as yup from \"yup\";\nimport $ from \"jquery\";\nimport ModalConfirm from \"../components/ModalConfirm.vue\";\n\nexport default {\n  name: \"EditDishPage\",\n  components: { Form, ModalConfirm },\n  data() {\n    return {\n      isFormSubmited: false,\n      currentDishId: null,\n      isCreateDishModalOpen: false,\n      isEditDishModalOpen: false,\n      formData: {\n        // Vue Object Data will be convert into Observer\n        dishId: \"This field is omitted when creating new dish\",\n        imageUrl: \"\",\n        dishTitle: \"\",\n        dishDescription: \"\",\n      },\n      errorMessages: {\n        dishId: \"\",\n        imageUrl: \"\",\n        dishTitle: \"\",\n        dishDescription: \"\",\n      },\n\n      // Add field with name in errorMessages for others' validation\n      schema: yup.object().shape({}),\n    };\n  },\n  beforeMount() {\n    this.currentDishId = this.$route.params.id;\n    if (this.currentDishId) {\n      this.GetDishData();\n    }\n  },\n\n  methods: {\n    toggleModalOpen(type) {\n      if (type === \"createDish\") {\n        this.isCreateDishModalOpen = !this.isCreateDishModalOpen;\n      } else if (type === \"editDish\") {\n        this.isEditDishModalOpen = !this.isEditDishModalOpen;\n      }\n    },\n\n    GetDishData() {\n      var settings = {\n        url: `${process.env.VUE_APP_API_URL}/dish/{${this.currentDishId}}`,\n        method: \"GET\",\n        timeout: 0,\n        data: {},\n        headers: {},\n      };\n\n      $.ajax(settings).then((response) => {\n        response = JSON.parse(response);\n        if (response.status === 200) {\n          const dish = response.response;\n          this.formData.dishId = this.currentDishId;\n          this.formData.imageUrl = dish.image;\n          this.formData.dishTitle = dish.name;\n          this.formData.dishDescription = dish.description;\n        } else {\n          alert(\"Cannot get dish to edit\");\n        }\n      });\n    },\n\n    async handleInputValidation({ name, value }) {\n      let validationResult = await this.schema\n        .validate({ [name]: value })\n        .catch((error) => {\n          return error;\n        });\n      if (validationResult.errors) {\n        this.errorMessages[name] = validationResult.errors[0];\n      } else {\n        this.errorMessages[name] = \"\";\n      }\n    },\n\n    handleFormChange(newData) {\n      this.formData[newData.name] = newData.value;\n      this.handleInputValidation(newData);\n    },\n\n    handleSubmit() {\n      var __this = this;\n      const formData = JSON.parse(JSON.stringify(this.formData));\n\n      const UserToken = localStorage.getItem(\"UserToken\");\n      if (UserToken === \"\") {\n        alert(\"Please login admin account before to edit or create dish\");\n        return;\n      }\n\n      this.isFormSubmited = true;\n      if (this.$route.name === \"adminCreateDish\") {\n        /**\n         * Handle Edit Profile\n         */\n        this.toggleModalOpen(\"createDish\");\n        let settings = {\n          url: `${process.env.VUE_APP_API_URL}/admin/create_dish`,\n          method: \"post\",\n          timeout: 0,\n          data: {\n            image: formData.imageUrl,\n            name: formData.dishTitle,\n            description: formData.dishDescription,\n          },\n          headers: {\n            \"Bear-Token\": UserToken,\n          },\n        };\n        $.ajax(settings).done(function(response) {\n          response = JSON.parse(response);\n          if (response.status == 200) {\n            __this.$refs.noteTitle.innerHTML = \"Your Dish Have Been Created\";\n            __this.$router.replace({ name: \"adminMenu\" });\n          } else {\n            __this.$refs.noteTitle.innerHTML = response.message;\n          }\n        });\n      } else if (this.$route.name === \"adminEditDish\") {\n        /**\n         * Handle Edit Password\n         */\n        this.toggleModalOpen(\"editDish\");\n        let settings = {\n          url: `${process.env.VUE_APP_API_URL}/admin/update_dish/{${this.currentDishId}}`,\n          method: \"post\",\n          timeout: 0,\n          data: {\n            image: formData.imageUrl,\n            name: formData.dishTitle,\n            description: formData.dishDescription,\n          },\n          headers: {\n            \"Bear-Token\": UserToken,\n          },\n        };\n        $.ajax(settings).done(function(response) {\n          response = JSON.parse(response);\n          if (response.status == 200) {\n            __this.$refs.noteTitle.innerHTML = \"Your Dish Have Been Edited\";\n            __this.$router.replace({ name: \"adminMenu\" });\n          } else {\n            __this.$refs.noteTitle.innerHTML = response.message;\n          }\n        });\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.edit-dish-wrapper {\n  margin: 50px 0 50px 0;\n}\n.reservation-title {\n  font-family: Oleo Script Swash Caps;\n  text-align: center;\n  font-size: 500%;\n  margin: 0px 0px 50px 0px;\n}\n.reservation-note {\n  margin: 20px auto;\n  width: 100%;\n  border-radius: 20px;\n  background-color: #ededed;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-wrap: wrap;\n}\n\n.reservation-note > * {\n  width: 100%;\n}\n\n.note-title {\n  font-family: Oleo Script Swash Caps;\n  text-align: center;\n  font-size: 200%;\n  margin: 20px 0 20px 0;\n}\n\n.form-wrapper {\n  width: 50%;\n  margin: auto;\n}\n\n@media screen and (max-width: 1700px) {\n  .form-wrapper {\n    width: 60%;\n  }\n}\n\n@media screen and (max-width: 1400px) {\n  .form-wrapper {\n    width: 70%;\n  }\n}\n\n@media screen and (max-width: 1000px) {\n  .form-wrapper {\n    width: 80%;\n  }\n}\n\n@media screen and (max-width: 700px) {\n  .form-wrapper {\n    width: 90%;\n  }\n}\n</style>\n"]}]}